<html>
<head>
	<title>Automate</title>
	<link rel="stylesheet" type="text/css" href="main.css">
	
	<meta content="yes" name="apple-mobile-web-app-capable">
    <meta id="viewport" name='viewport'>
	<script>
		(function(doc) {
			var viewport = document.getElementById('viewport');
			if ( navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i)) {
				doc.getElementById("viewport").setAttribute("content", "width=device-width; initial-scale=1.5; maximum-scale=1.5; minimum-scale=1.5; user-scalable=0");
			} 
		}(document));
		
		document.ontouchmove = function(event){
			event.preventDefault();
		}
	</script>
	<script src="jquery-1.8.1.min.js"></script>
</head>

<body>

<div class="wrapper">
	<!--<div class="tile blinds" state="0" id="0"></div>-->
	<div class="tile deadbolt" state="0" id="3"></div>
	<div class="tile outlet" state="0" id="1"></div>
	<div class="tile outlet" state="0" id="2"></div>
	
	<div style="clear:both"></div>
</div>

<script>

var preventClick = false;

$("div.tile").bind("touchstart", function(event) {
	$(event.target).addClass("touched");
});

$("div.tile").bind("touchend",function(event) {
	preventClick = true;
	setTimeout( 
		function() { 
			preventClick = false; 
		}
		, 400
	);
	
	activate(event);
});

$("div.tile").bind("click", function(event) {
	if ( preventClick ) { 
		return;
	}
	
	activate(event);
});

function activate(event) {
	$(event.target).removeClass("touched");
	
	var query = "address=" + $(event.target).attr("id") + "&" +
				"state=" + $(event.target).attr("state") + "&";
	
	$.get("test.wsgi?"+query, function(data) {
		// Done
	});
	
	// Toggle the state of the button
	if ( $(event.target).attr("state") == "0" ) {
		$(event.target).attr("state","1");
		$(event.target).css("background-position", "-100%");
	} else {
		$(event.target).attr("state","0");
		$(event.target).css("background-position", "0%");
	}
}

</script>

</body>
</html>
